<?xml version="1.0" ?>
<Schema name="{{ mondrian_schema_name}}">
  <Cube name="{{ cube_name }}">
    <Annotations>
      <Annotation name="source_name">Census Bureau</Annotation>
      <Annotation name="source_description">Census Bureau conducts surveys of the United States Population, including the American Community Survey</Annotation>
      <Annotation name="dataset_name">ACS {{ acs_est }}-year Estimate</Annotation>
      <Annotation name="dataset_link">http://www.census.gov/programs-surveys/acs/</Annotation>
      <Annotation name="table_id">{{ acs_table_id }}</Annotation>
      <Annotation name="topic">{{ metadata.topic }}</Annotation>
      {%- if metadata.subtopic %}
      <Annotation name="topic">{{ metadata.subtopic }}</Annotation>
      {%- endif %}
    </Annotations>
    <Table name="{{ db_table_name }}" schema="{{ db_schema }}"/>

    <DimensionUsage foreignKey="geoid" name="Geography" source="geography"/>
      <Annotations>
        <Annotation name="dim_type">GEOGRAPHY</Annotation>
      </Annotations>
    </DimensionUsage>

    <Dimension name="Year">
      <Hierarchy hasAll="true">
        <Level column="year" levelType="TimeYears" name="Year" type="Numeric" uniqueMembers="true"/>
      </Hierarchy>
      <Annotations>
        <Annotation name="dim_type">TIME</Annotation>
      </Annotations>
    </Dimension>

  {%- for dim_context in dim_contexts %}
    <Dimension foreignKey="dim_{{ dim_context.code }}" name="{{ dim_context.title }}">
      <Hierarchy hasAll="true"{% if is_non_agg %} defaultMember="[{{ dim_context.title }}].[Total]"{% endif %}>
        <InlineTable alias="dim_{{ dim_context.code }}_table">
          <ColumnDefs>
          {%- for member_idx in range(end=dim_context.num_levels) %}
            <ColumnDef name="member_{{ member_idx }}_code" type="Numeric"/>
            <ColumnDef name="member_{{ member_idx }}" type="String"/>
          {%- endfor %}
          </ColumnDefs>
          <Rows>
          {%- for row in dim_context.inline_table %}
            <Row>
            {%- for row_code_label in row -%}
              {# The loop.index0 should match with the member_idx above #}
              <Value column="member_{{ loop.index0 }}_code">{{ row_code_label.0 }}</Value>
              <Value column="member_{{ loop.index0 }}">{{ row_code_label.1 }}</Value>
            {%- endfor %}
            </Row>
          {%- endfor %}
          </Rows>
        </InlineTable>
      {%- for level in dim_context.levels -%}
      {#  This should be coupled to Value loop #}
      <Level column="member_{{ loop.index0 }}_code" hideMemberIf="IfParentsName" name="{{ level }}" nameColumn="member_{{  loop.index0 }}" uniqueMembers="true"/>
      {%- endfor %}
      </Hierarchy>
    </Dimension>
  {% endfor %}

{%- if is_race_cube %}
{% include "race.xml" %}
{%- endif %}
{%- if is_health_cube %}
{% include "health.xml" %}
{%- endif %}
{%- if is_kaiser_health_cube %}
{% include "kaiser_health_dim.xml" %}
{%- endif %}

{%- if explode_dim %}
{% include "explode_mea.xml" %}
{%- else %}
{% include "default_mea.xml" %}
{%- endif %}

    <!-- Here add in rca and percent calc if asked for -->
{%- if calc_rca %}
{% include "rca.xml" %}
{%- endif %}
{% if calc_percent %}Calculate percent{% endif %}
  </Cube>
</Schema>
